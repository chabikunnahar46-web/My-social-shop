<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bondhutto24 Profile</title>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

  const firebaseConfig = {
      apiKey: "AIzaSyA33of57qBOpIUioKDQ7dMx0KZR6OXLECY",
      authDomain: "bondhotto-24.firebaseapp.com",
      projectId: "bondhotto-24",
      storageBucket: "bondhotto-24.appspot.com",
      messagingSenderId: "585952718894",
      appId: "1:585952718894:web:1d9b2e9f12f617a2f2afbf"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const storage = getStorage(app);

  // ==============================
  // Auth Functions
  // ==============================
  window.signUp = async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      alert("‚úÖ Sign Up Successful");
    } catch (err) { alert(err.message); }
  }

  window.logIn = async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
      alert("‚úÖ Logged In Successfully");
    } catch (err) { alert(err.message); }
  }

  window.logOut = async () => {
    await signOut(auth);
    alert("‚úÖ Logged Out");
  }

  // ==============================
  // Upload Cover / Profile Photo
  // ==============================
  window.uploadProfilePhoto = async () => {
    const file = document.getElementById("profilePhoto").files[0];
    if(!file) return alert("Select a photo first!");
    const user = auth.currentUser;
    if(!user) return alert("Login first!");

    const storageRef = ref(storage, 'profile_photos/' + user.uid + '_' + Date.now() + '_' + file.name);
    const uploadTask = uploadBytesResumable(storageRef, file);
    await new Promise((resolve,reject)=>uploadTask.on('state_changed', null, e=>reject(e), ()=>resolve()));
    const url = await getDownloadURL(storageRef);

    await addDoc(collection(db, "profile_photos"), { uid: user.uid, type:"profile", url, timestamp: serverTimestamp() });
    document.getElementById("profilePhoto").value = "";
  }

  window.uploadCoverPhoto = async () => {
    const file = document.getElementById("coverPhoto").files[0];
    if(!file) return alert("Select a photo first!");
    const user = auth.currentUser;
    if(!user) return alert("Login first!");

    const storageRef = ref(storage, 'cover_photos/' + user.uid + '_' + Date.now() + '_' + file.name);
    const uploadTask = uploadBytesResumable(storageRef, file);
    await new Promise((resolve,reject)=>uploadTask.on('state_changed', null, e=>reject(e), ()=>resolve()));
    const url = await getDownloadURL(storageRef);

    await addDoc(collection(db, "profile_photos"), { uid: user.uid, type:"cover", url, timestamp: serverTimestamp() });
    document.getElementById("coverPhoto").value = "";
  }

  // ==============================
  // Add Post Function
  // ==============================
  window.addPost = async () => {
    const text = document.getElementById("postText").value;
    const imageFile = document.getElementById("postImage").files[0];
    if(!text && !imageFile) return alert("Post cannot be empty!");

    let imageUrl = "";
    if(imageFile){
      const storageRef = ref(storage, 'posts/' + Date.now() + '_' + imageFile.name);
      const uploadTask = uploadBytesResumable(storageRef, imageFile);
      await new Promise((resolve,reject)=>uploadTask.on('state_changed', null, e=>reject(e), ()=>resolve()));
      imageUrl = await getDownloadURL(storageRef);
    }

    const user = auth.currentUser;
    if(!user) return alert("Login first!");

    await addDoc(collection(db, "posts"), { user: user.email, text, image: imageUrl, timestamp: serverTimestamp() });
    document.getElementById("postText").value = "";
    document.getElementById("postImage").value = "";
  }

  // ==============================
  // Real-time Posts Listener
  // ==============================
  const postsDiv = document.getElementById("posts");
  function loadUserPosts(userEmail){
    const postsQuery = query(collection(db, "posts"), orderBy("timestamp","desc"));
    onSnapshot(postsQuery, snapshot=>{
      postsDiv.innerHTML="";
      snapshot.forEach(doc=>{
        const post=doc.data();
        if(post.user===userEmail){
          const div=document.createElement("div");
          div.classList.add("post-box");
          div.innerHTML=`
            <div class="post-user">${post.user}</div>
            <div class="post-text">${post.text||""}</div>
            ${post.image?`<img src="${post.image}" />`:""}
            <div class="post-actions">
              <button onclick="alert('Liked!')">‚ù§Ô∏è Like</button>
              <button onclick="alert('Comment clicked!')">üí¨ Comment</button>
              <button onclick="alert('Shared!')">üîÅ Share</button>
            </div>
          `;
          postsDiv.appendChild(div);
        }
      });
    });
  }

  // ==============================
  // Auth State Listener
  // ==============================
  onAuthStateChanged(auth,user=>{
    const authDiv=document.getElementById("authDiv");
    const profileName=document.getElementById("profileName");
    if(user){
      authDiv.innerHTML=`<button onclick="logOut()">Log Out</button>`;
      profileName.innerText=user.email;
      loadUserPosts(user.email);
    } else {
      authDiv.innerHTML=`
        Email: <input id="email" placeholder="Email" />
        Password: <input type="password" id="password" placeholder="Password" />
        <button onclick="signUp()">Sign Up</button>
        <button onclick="logIn()">Log In</button>
      `;
      profileName.innerText="Guest";
    }
  });

</script>

<style>
body{margin:0;font-family:Arial;background:#f0f2f5;}
header{background:#1877f2;color:white;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;}
header h1{margin:0;}
.container{max-width:600px;margin:20px auto;}
.profile-header{background:white;padding:10px;border-radius:8px;margin-bottom:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);text-align:center;position:relative;}
.cover-photo{width:100%;height:150px;background:#ccc;border-radius:8px 8px 0 0;object-fit:cover;}
.profile-photo{width:100px;height:100px;border-radius:50%;border:3px solid white;position:absolute;bottom:-50px;left:calc(50% - 50px);object-fit:cover;}
.profile-name{margin-top:60px;font-weight:bold;}
.post-box{background:white;padding:15px;border-radius:8px;margin-bottom:15px;box-shadow:0 1px 3px rgba(0,0,0,0.1);}
.post-user{font-weight:bold;margin-bottom:5px;}
.post-text{margin-bottom:10px;}
.post-actions{display:flex;justify-content:space-between;font-size:14px;color:#65676b;}
.post-actions button{border:none;background:none;cursor:pointer;color:#65676b;}
#authDiv input{padding:5px;margin:3px;}
#authDiv button{padding:5px;margin:3px;background:#1877f2;color:white;border:none;border-radius:3px;cursor:pointer;}
</style>
</head>

<body>
<header>
  <h1>Bondhutto24 Profile</h1>
  <div id="authDiv"></div>
</header>

<div class="container">
  <div class="profile-header">
    <img id="coverImg" class="cover-photo" src="https://via.placeholder.com/600x150" />
    <img id="profileImg" class="profile-photo" src="https://via.placeholder.com/100" />
    <h2 id="profileName" class="profile-name">Guest</h2>
    <div style="margin-top:10px;">
      <input type="file" id="coverPhoto" accept="image/*">
      <button onclick="uploadCoverPhoto()">Upload Cover</button>
      <input type="file" id="profilePhoto" accept="image/*">
      <button onclick="uploadProfilePhoto()">Upload Profile</button>
    </div>
  </div>

  <div class="new-post">
    <textarea id="postText" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶° ‡¶¨‡¶æ ‡¶≠‡¶æ‡¶¨ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®..."></textarea><br>
    <input type="file" id="postImage" accept="image/*"><br>
    <button onclick="addPost()">üì§ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  </div>

  <div id="posts"></div>
</div>
</body>
</html>
